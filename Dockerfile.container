FROM alpine AS tools_builder
RUN apk add --no-cache busybox

FROM scratch

ARG TARGETOS
ARG TARGETARCH

RUN mkdir -p /lib /bin /binaries

WORKDIR /

COPY --from=tools_builder /lib/ld-musl-*.so.1 /lib/

COPY --from=tools_builder /bin/busybox /busybox

RUN ["/busybox", "sh", "-c", "/busybox --install -s /bin && /bin/mkdir -p /binaries"]

COPY bin/*$TARGETOS-$TARGETARCH /binaries/

CMD ["/bin/ls", "-lrt", "/binaries/"]